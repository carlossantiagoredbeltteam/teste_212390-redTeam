<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Fat16: Arduino Fat16 Library</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Arduino Fat16 Library</h1>
<p>
<center>Copyright &copy; 2008 by William Greiman </center><h2><a class="anchor" name="Intro">
Introduction</a></h2>
The Arduino <a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a> Library is a minimal implementation of the FAT16 file system on standard SD flash memory cards. <a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a> supports read, write and file creation.<p>
The <a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a> class only supports access to files in the root directory and only supports short 8.3 names. Directory time and date fields for creation, access and write are not maintained.<p>
<a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a> was designed to use the Arduino Version 12 <a class="el" href="class_print.html" title="The Arduino core Print class.">Print</a> class which allows files to be written with <a class="el" href="class_print.html#6309cc0fb10c5f50517069ae86bf60d7">print() </a> and <a class="el" href="class_print.html#525b37c566658ff8113a067f6e8d5bf1">println()</a>.<p>
It should be possible to use <a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a> with storage devices other than SD flash cards. Hardware access can be through any class derived from the <a class="el" href="class_block_device.html" title="BlockDevice is the base class for devices supported by Fat16.">BlockDevice</a> class.<h2><a class="anchor" name="Hardware">
Hardware Configuration</a></h2>
<a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a> was developed using an <a href="http://www.adafruit.com/">Adafruit Industries</a> <a href="http://ladyada.net/make/gpsshield/modules.html">GPS Shield</a>. See the <a href="http://ladyada.net/make/gpsshield/download.html">Schematic </a> for details.<h2><a class="anchor" name="Warning">
Warning</a></h2>
<a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a> has been tested with several SD Cards but is bound to contain many bugs. In most companies this would be called pre-alpha software. I hope people will try it and send me comments.<h2><a class="anchor" name="comment">
Bugs and Comments</a></h2>
If you wish to report bugs or have comments, send email to <a href="mailto:fat16lib@sbcglobal.net">fat16lib@sbcglobal.net</a>.<h2><a class="anchor" name="Fat16Class">
Fat16 Usage</a></h2>
The class <a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a> is a minimal implementation of FAT16 on standard SD cards. High Capacity SD cards, SDHC, are not supported. It should work on all standard cards from 8MB to 2GB formatted with a FAT16 file system.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>The Arduino <a class="el" href="class_print.html" title="The Arduino core Print class.">Print</a> class uses character at a time writes so it was necessary to use a <a class="el" href="class_fat16.html#a8919ff5c1b3e5470dbd38a6f7710d20">sync() </a> function to control when data is written to the SD card.</dd></dl>
<dl class="user" compact><dt><b></b></dt><dd>An application which writes to a file using <a class="el" href="class_print.html#6309cc0fb10c5f50517069ae86bf60d7">print()</a>, <a class="el" href="class_print.html#525b37c566658ff8113a067f6e8d5bf1">println() </a> or <a class="el" href="class_fat16.html#d1cfc594294d7dafd2e77377252d82c9">write() </a> must call <a class="el" href="class_fat16.html#a8919ff5c1b3e5470dbd38a6f7710d20">sync() </a> at the appropriate time to force data and directory information to be written to the SD Card. Data and directory information are also written to the SD card when <a class="el" href="class_fat16.html#ae3355bf1e93e732a64149663133161a">close() </a> is called.</dd></dl>
<dl class="user" compact><dt><b></b></dt><dd>Applications must use care calling <a class="el" href="class_fat16.html#a8919ff5c1b3e5470dbd38a6f7710d20">sync() </a> since 2048 bytes of I/O is required to update file and directory information. This includes writing the current data block, reading the block that contains the directory entry for update, writing the directory block back and reading back the current data block.</dd></dl>
<a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a> only supports access to files in the root directory and only supports short 8.3 names.<p>
It is possible to open a file with two or more instances of <a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a>. A file may be corrupted if data is written to the file by more than one instance of <a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a>.<p>
Short names are limited to 8 characters followed by an optional period (.) and extension of up to 3 characters. The characters may be any combination of letters and digits. The following special characters are also allowed:<p>
$ % ' - _ @ ~ ` ! ( ) { } ^ # &amp;<p>
Short names are always converted to upper case and their original case value is lost.<p>
<a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a> uses a slightly restricted form of short names. Only printable ASCII characters are supported. No characters with code point values greater than 127 are allowed. Space is not allowed even though space was allowed in the API of early versions of DOS.<p>
<a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a> has been optimized for The Arduino ATmega168. Minimizing RAM use is the highest priority goal followed by flash use and finally performance. Most SD cards only support 512 byte block write operations so a 512 byte cache buffer is used by <a class="el" href="class_fat16.html" title="Fat16 implements a minimal Arduino FAT16 Library.">Fat16</a>. This is the main use of RAM. A small amount of RAM is used to store key volume and file information. Flash memory usage can be controlled by selecting options in <a class="el" href="_fat16_config_8h.html">Fat16Config.h</a>.<h2><a class="anchor" name="HowTo">
How to format SD Cards as FAT16 Volumes</a></h2>
Microsoft operating systems support removable media formatted with a Master Boot Record, MBR, or formatted as a super floppy with a FAT Boot Sector in block zero.<p>
Microsoft operating systems expect MBR formatted removable media to have only one partition. The first partition should be used.<p>
Microsoft operating systems do not support partitioning SD flash cards. If you erase an SD card with a program like KillDisk, Most versions of Windows will format the card as a super floppy.<p>
The best way to restore an SD card's MBR is to use SDFormatter which can be downloaded from:<p>
<a href="http://www.sdcard.org/consumers/formatter/">http://www.sdcard.org/consumers/formatter/</a><p>
SDFormatter does not have an option for FAT type so it may format small cards as FAT12 and larger cards as FAT32.<p>
After the MBR is restored by SDFormatter you can reformat it and force the volume type to be FAT16 by selecting the FAT option on XP or specifying the "Allocation unit size" on Vista.<p>
The FAT type, FAT12, FAT16, or FAT32, is determined by the count of clusters on the volume and nothing else.<p>
Microsoft published the following code for determining FAT type:<p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">if</span> (CountOfClusters &lt; 4085) {
  <span class="comment">// Volume is FAT12</span>
}
<span class="keywordflow">else</span> <span class="keywordflow">if</span> (CountOfClusters &lt; 65525) {
  <span class="comment">// Volume is FAT16</span>
}
<span class="keywordflow">else</span> {
  <span class="comment">// Volume is FAT32</span>
}
</pre></div> When you format a FAT volume, choose a cluster size that will result in:<p>
4084 &lt; CountOfClusters &amp;&amp; CountOfClusters &lt; 65525<p>
The volume will then be FAT16.<p>
If you are formatting an SD card on OS X or Linux, be sure to use the first partition. Format this partition with a cluster count in above range.<h2><a class="anchor" name="References">
References</a></h2>
The Arduino site:<p>
<a href="http://www.arduino.cc/">http://www.arduino.cc/</a><p>
For more information about FAT file systems see:<p>
<a href="http://www.microsoft.com/whdc/system/platform/firmware/fatgen.mspx">http://www.microsoft.com/whdc/system/platform/firmware/fatgen.mspx</a><p>
For information about using SD cards as SPI devices see:<p>
<a href="http://www.sdcard.org/developers/tech/sdcard/pls/Simplified_Physical_Layer_Spec.pdf">http://www.sdcard.org/developers/tech/sdcard/pls/Simplified_Physical_Layer_Spec.pdf</a><p>
The ATmega168 datasheet:<p>
<a href="http://www.atmel.com/dyn/resources/prod_documents/doc8025.pdf">http://www.atmel.com/dyn/resources/prod_documents/doc8025.pdf</a> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Oct 9 08:22:19 2008 for Fat16 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
